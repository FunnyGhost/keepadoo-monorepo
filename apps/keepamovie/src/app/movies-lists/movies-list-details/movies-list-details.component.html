<div>
  <ng-container *ngIf='isLoading$ | async; else moviesTemplate'>
    <div class='flex justify-center items-center'>
      <svg-icon data-test-name='loading' class='w-24 h-24' key='loading'></svg-icon>
    </div>
  </ng-container>
  <ng-template #moviesTemplate>
    <section
      class='border-b border-purple-300 flex flex-row flex-wrap justify-center items-end mb-4 mx-2 md:mx-0 py-2'>
      <h1
        class='text-2xl text-gray-700 text-center md:text-left w-full md:w-auto my-4 md:my-o font-bold font-serif flex-grow'
        data-test-name='listName'
        *ngIf='selectedList$ | async as selectedList'>
        {{ selectedList.name }}
      </h1>

      <button
        data-test-name='addModeButton'
        (click)='enableAddMode()'
        class='flex w-2/5 md:w-auto justify-center items-center text-xs text-gray-700 rounded bg-yellow-400 shadow-md mx-2 px-4 py-1 hover:bg-yellow-600 hover:text-white transition duration-200'>
        <svg-icon key='search' class='mr-2' size='lg'></svg-icon>
        <span>
             Add movie
        </span>
      </button>

      <button
        data-test-name='editModeButton'
        class='w-2/5 md:w-16 text-xs text-gray-600 font-sans bg-white rounded shadow-md mx-2 py-2 hover:bg-gray-300 transition duration-200'
        (click)='edit()' *ngIf='(editMode$ | async) === false'>Edit
      </button>
      <button
        data-test-name='doneButton'
        class='w-2/5 md:w-16 text-xs text-gray-600 font-sans bg-gray-100 rounded shadow-md mx-2 py-2 hover:bg-gray-300 transition duration-200'
        (click)='done()' *ngIf='(editMode$ | async) === true'>Done
      </button>
    </section>

    <section *ngIf='movies$ | async as movies'
             class='grid grid-cols-1 md:grid-cols-2 justify-items-center md:justify-items-start'>
      <keepadoo-movie
        class='w-full px-2 md:px-0'
        *ngFor='let movie of movies'
        [movie]='movie'
        [editMode]='editMode$ | async'
        (delete)='deleteMovie($event)'
      ></keepadoo-movie>
      <section *ngIf='movies.length === 0'>
        <span
        >Please use the
          button bellow to add your first movie to this list. Magical!</span
        >
      </section>
    </section>

    <section *ngIf='(editMode$ | async) === true' class='mt-4'>
      <button (click)='askForDeleteConfirmation()' data-test-name='deleteButton'
              class='text-xs font-sans text-gray-600 rounded bg-red-400 shadow-md py-2 px-8 hover:bg-red-600 hover:text-white transition duration-200'>
        Delete list
      </button>

      <keepadoo-dialog [(visible)]='showConfirmationDialog'>
        <h4 class='font-sans text-lg font-bold'>Are you sure you want to delete this list?</h4>
        <section class='mt-8'>
          <button
            data-test-name='confirmDeleteButton'
            class='text-xs font-sans text-gray-600 rounded bg-red-300 shadow-md py-2 px-6 mr-2 hover:bg-red-600 hover:text-white transition duration-200'
            (click)='deleteList()'>Yes
          </button>
          <button
            data-test-name='cancelDeleteButton'
            class='text-xs font-sans rounded bg-gray-100 shadow-md text-gray-600 py-2 px-6 hover:bg-gray-300 transition duration-200'
            (click)='cancelListDeletion()'>No
          </button>
        </section>
      </keepadoo-dialog>
    </section>
  </ng-template>
</div>

<section
  class='absolute rounded-md shadow top-0 left-0 z-10 w-full h-full transition transform origin-bottom duration-500 bg-white'
  [ngClass]="{'translate-y-0 scale-y-100': addMovieMode, 'translate-y-full scale-y-0': !addMovieMode}">
  <keepadoo-movie-search (done)='disableAddMode()'></keepadoo-movie-search>
</section>
